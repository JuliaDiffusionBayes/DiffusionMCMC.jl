<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Conjugate updates · DiffusionMCMC.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">DiffusionMCMC.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../get_started/overview/">Get started</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">User manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../how_extend/">Extension of ExtensibleMCMC.jl</a></li><li><a class="tocitem" href="../updates_and_decorators/">Updates &amp; Decorators</a></li><li><a class="tocitem" href="../blocking/">(TODO) Blocking</a></li><li><a class="tocitem" href="../callbacks/">(TODO) Callbacks</a></li><li><a class="tocitem" href="../workspaces/">Diffusion Workspaces</a></li><li class="is-active"><a class="tocitem" href>Conjugate updates</a><ul class="internal"><li><a class="tocitem" href="#Conjugate-Gaussian-updates-1"><span>Conjugate Gaussian updates</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How to...</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../how_to_guides/smoothing/">(TODO) Do smoothing</a></li><li><a class="tocitem" href="../../how_to_guides/blocking/">(TODO) Do blocking</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/simple_inference/">Inference &amp; smoothing for the FitzHugh–Nagumo model</a></li><li><a class="tocitem" href="../../tutorials/conjugate_updates/">Conjugate updates for the FitzHugh–Nagumo model</a></li><li><a class="tocitem" href="../../tutorials/inference_fpt/">(TODO) Inference from first-passage time observations</a></li><li><a class="tocitem" href="../../tutorials/mixed_effects_models/">(TODO) Mixed-effect models</a></li></ul></li><li><a class="tocitem" href="../../module_index/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User manual</a></li><li class="is-active"><a href>Conjugate updates</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Conjugate updates</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaDiffusionBayes/DiffusionMCMC.jl/blob/master/docs/src/manual/conjugate_updates.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="conjugate_updates_explanation-1"><a class="docs-heading-anchor" href="#conjugate_updates_explanation-1">Conjugate updates</a><a class="docs-heading-anchor-permalink" href="#conjugate_updates_explanation-1" title="Permalink"></a></h1><hr/><p>Sometimes a subset of parameters conditioned on the realization of the path admits a representation that is given by one of the standard statistical distributions. This means that no Metropolis–Hastings step needs to be employed for the step of updating such parameters, and instead, they can be simply sampled exactly from their conditional distribution. For the case of diffusions two such cases are most frequently encountered in practice.</p><ol><li>When a <strong>prior</strong> for the <strong>parameters in the drift</strong> is set to be (multivariate) Gaussian, then the distribution of those parameters conditionally on the path <span>$X$</span> can <strong>sometimes</strong> be identified as a Gaussian distribution as well. We will refer to this case as <strong>conjugate Gaussian updates</strong>.</li><li>When a <strong>prior</strong> for the <strong>parameters in the volatility coefficient</strong> is set to be (multivariate) Gaussian, then the distribution of those parameters conditionally on the path <span>$X$</span> can <strong>sometimes</strong> be identified as an Inverse-Wishart distribution. We will refer to this case as <strong>conjugate Gaussian-Inverse-Wishart updates</strong> (TODO this section needs to be written up and coded up).</li></ol><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The word <strong>sometimes</strong> is important. It will not be possible to always find conjugate Gaussian updates for any parameters in the drift, nor will it be possible for any parameters in the volatility coefficients we please. They must additionally satisfy certain conditions that we describe below.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Conjugate updates may dramatically improve mixing of the Markov chains; however, for users inexperienced in stochastic analysis this might be a risky option that may potentially yield incorrect results. The reason is that your stochastic differential equation must obey certain principles (which for certain examples can become quite delicate) and if those principles are not satisfied your code might still run and return some answer, but the answer will not be correct. Consequently, we urge the user to exert caution when employing conjugate updates. Below, we try to present the relevant background for employing conjugate updates.</p></div></div><h2 id="Conjugate-Gaussian-updates-1"><a class="docs-heading-anchor" href="#Conjugate-Gaussian-updates-1">Conjugate Gaussian updates</a><a class="docs-heading-anchor-permalink" href="#Conjugate-Gaussian-updates-1" title="Permalink"></a></h2><hr/><h3 id="Statement-of-the-result-1"><a class="docs-heading-anchor" href="#Statement-of-the-result-1">Statement of the result</a><a class="docs-heading-anchor-permalink" href="#Statement-of-the-result-1" title="Permalink"></a></h3><p>Suppose we have a stochastic differential equation of the form:</p><div>\[\begin{align*}
    \dd X_t^{[1:m]} &amp;= β(t,X_t)\dd t,\\
    \dd X_t^{[(m+1):d]} &amp;= \left[φ(t,X_t)θ + ϕ(t,X_t)\right]\dd t + σ(t,X_t) \dd W_t,
\end{align*}\]</div><p>where the notation <span>$\cdot^{[a:b]}$</span> is used to represent subvectors. If <span>$m=0$</span>, then the first row disappears. <span>$W$</span> denotes a <span>$(d-m)$</span>-dimensional Wiener process, <span>$θ\in\RR^p$</span>, <span>$φ:\RR\times\RR^d→\RR^{(d-m)}\times\RR^{p}$</span> and <span>$ϕ:\RR\times\RR^d→\RR^{(d-m)}$</span>. Suppose further that <span>$θ$</span> comes equipped with a multivariate Gaussian prior:</p><div>\[π(θ)∼N(μ,Σ)\]</div><p>Then, <strong>formally</strong>, the distribution of the parameters <span>$θ$</span> conditionally on the realization of the path <span>$X$</span> is Gaussian:</p><div>\[π(θ|X)∼N\left(
    \left(\mathcal{W} + Σ^{-1}\right)^{-1}\left[λ + Σ^{-1}μ\right],
    \left(\mathcal{W} + Σ^{-1}\right)^{-1}
\right),\]</div><p>where</p><div>\[λ:=\int_0^T \left[
        φ^T\left(σσ^T\right)^{-1}
    \right](t,X_t) \dd X_t^{[(m+1):d]}
    - \int_0^T \left[
        φ^T\left(σσ^T\right)^{-1}ϕ
    \right](t,X_t) \dd t\]</div><p>and</p><div>\[W:=\int_0^T \left[
    φ^T\left(σσ^T\right)^{-1}φ
\right](t,X_t) \dd t\]</div><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The result is only formal and not rigorous. For it to be rigorous one needs to make sure that the target and the dominating laws are well-defined and that the Radon–Nikodym derivative between the two exists (and is given by the implicitly assumed expression).</p></div></div><h3 id="Coding-conjugate-Gaussian-updates-up-1"><a class="docs-heading-anchor" href="#Coding-conjugate-Gaussian-updates-up-1">Coding conjugate Gaussian updates up</a><a class="docs-heading-anchor-permalink" href="#Coding-conjugate-Gaussian-updates-up-1" title="Permalink"></a></h3><p>The major bulk of the computations is already pre-coded in the package; however, the user needs to provide the functions <span>$φ$</span> and <span>$ϕ$</span> as well as indicate which coordinates are non-degenerate (in the above the first <span>$m$</span> coordinates are degenerate; however, in general they can appear at any position and be interlaced with non-degenerate ones, the user needs to simply indicate in a list which ones have non-zero volatility).</p><p>To help with this process we can use a macro <code>@conjugate_gaussian</code> from the package <a href="https://juliadiffusionbayes.github.io/DiffusionDefinition.jl/dev/">DiffusionDefinition.jl</a> (see [this page] for the documentation of this macro). To specify which coordinates are non-degenerate pass <code>:nonhypo --&gt; collect((m+1):d)</code> say to <code>@conjugate_gaussian</code>. Function <code>phi</code> should be specified parameter after parameter by passing pairs of <code>parameter-name</code>—<span>$φ^{[i,:]}(t,x)$</span>, where <code>parameter-name</code> corresponds to the ith parameter and <span>$φ^{[i,:]}(t,x)$</span> is simply an ith row of <span>$φ(t,x)$</span>. Function can be defined directly by overloading</p><article class="docstring"><header><a class="docstring-binding" id="DiffusionMCMC.φᶜ" href="#DiffusionMCMC.φᶜ"><code>DiffusionMCMC.φᶜ</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">φᶜ(v, θᶜ, t, x, P::S, n=DD.num_non_hypo(S)) where S</code></pre><p>Remainder term in the drift after removing φ&#39;θ from it.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiffusionBayes/DiffusionMCMC.jl/blob/ceea88293d000c23cf1f8bf6deaf9b253b8973a0/src/updates.jl#LL311-L315">source</a></section></article><p>In here, <span>$θ^c$</span> denotes a vector of parameters other than <span>$θ$</span> (i.e. parameters assumed to be constant when updating <span>$θ$</span>), plus a single entry with 1, that represents terms independent from any parameters whatsoever.</p><p>Alternatively, if the remaining parameters <span>$θ^c$</span> also appear in a linear fashion in the drift, i.e. we have:</p><div>\[ϕ(t,x,θ^c) = φ^c(t,x)θ^c\]</div><p>for some function <span>$φ^c$</span> independent from <span>$θ^c$</span>, then we may specify the rows of function <span>$φ^c$</span> as if they were the rows of function <span>$φ$</span> and as if the parameters <span>$θ^c$</span> were being updated alongside <span>$θ$</span> instead of specifying <span>$ϕ$</span> directly. Then, we can simply indicate which parameters out of <span>$(θ, θ^c)$</span> are actually being updated with conjugate updates.</p><p>Function <span>$(σσ^T)^{-1}$</span> will be computed automatically based on the indicator of a subset of non-degenerate coordinates and based on the global volatility coefficient defining a diffusion process. However, we can speed up these computations by passing an expression for <span>$(σσ^T)^{-1}$</span> directly by passing <code>:hypo_a_inv --&gt; f(t,x,P)</code>.</p><h3 id="Example-1"><a class="docs-heading-anchor" href="#Example-1">Example</a><a class="docs-heading-anchor-permalink" href="#Example-1" title="Permalink"></a></h3><p>Consider a FitzHugh—Nagumo model in a slightly reparameterized form from <a href="https://juliadiffusionbayes.github.io/DiffusionDefinition.jl/dev/predefined_processes/fitzhugh_nagumo/#Conjugate-1">here</a>. We can define conjugate updates for it as follows:</p><pre><code class="language-julia">@conjugate_gaussian FitzHughNagumoConjug begin
    :intercept --&gt; (-x[2],)
    :ϵ --&gt; (x[1]-x[1]^3+(1-3*x[1]^2)*x[2],)
    :s --&gt; (one(x[1]),)
    :γ --&gt; (-x[1],)
    :β --&gt; (-one(x[1]),)
    :hypo_a_inv --&gt; 1.0/P.σ^2
    :nonhypo --&gt; 2:2
end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../workspaces/">« Diffusion Workspaces</a><a class="docs-footer-nextpage" href="../../how_to_guides/smoothing/">(TODO) Do smoothing »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 31 May 2020 13:20">Sunday 31 May 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
